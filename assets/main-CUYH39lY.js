(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const c of e)if(c.type==="childList")for(const n of c.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function t(e){const c={};return e.integrity&&(c.integrity=e.integrity),e.referrerPolicy&&(c.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?c.credentials="include":e.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(e){if(e.ep)return;e.ep=!0;const c=t(e);fetch(e.href,c)}})();document.querySelector("#app");const l="87c458e5ecf01f389261",d="8059374bf09b9ab28e639b6dbce3fe2be2d22b85",a="https://TristanB6.github.io/DM-demo---Auth-code-grant-type/auth-code-url.html";let h=`https://api.dailymotion.com/oauth/authorize?response_type=code&client_id=${l}&redirect_uri=${a}&scope=userinfo+read+manage_videos+email`;document.querySelector("#auth-code-url").href=h;const p=new URLSearchParams(window.location.search),i=p.get("code");(async()=>{if(i){console.log("Auth code detected, requesting access token");let s="https://api.dailymotion.com/oauth/token";try{const r=await fetch(s,{method:"POST",mode:"cors",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",client_id:l,client_secret:d,redirect_uri:a,code:i})});if(!r.ok)throw new Error(`Response status: ${r.status}`);const t=await r.json();if(console.log(t),t.access_token&&t.refresh_token&&t.expires_in){localStorage.setItem("auth_code_access_token",t.access_token),localStorage.setItem("auth_code_refresh_token",t.refresh_token),localStorage.setItem("auth_code_scope",t.scope);const o=Date.now()+t.expires_in*1e3;localStorage.setItem("auth_code_expires_at",o),console.log("Tokens saved to localStorage");const e=a.replace("auth-code-url.html","");window.location.href=e}else console.error("Tokens not found in response")}catch(r){console.error(r)}}})();function _(){const s=localStorage.getItem("auth_code_access_token"),r=localStorage.getItem("auth_code_refresh_token"),t=localStorage.getItem("auth_code_expires_at"),o=localStorage.getItem("auth_code_scope");if(s&&r&&t&&o){document.querySelector("#auth-code-access-token span").textContent=s,document.querySelector("#auth-code-refresh-token span").textContent=r,document.querySelector("#auth-code-scope span").textContent=o;const e=()=>{const n=Math.max(0,Math.floor((t-Date.now())/1e3)),u=document.querySelector("#auth-code-expires-in span");u.textContent=`${n} seconds`,n===0?(clearInterval(c),console.log("Access token has expired"),document.querySelector("#auth-code-access-token").classList.add("not-valid"),document.querySelector("#auth-code-refresh-token").classList.add("not-valid"),document.querySelector("#auth-code-expires-in").classList.add("not-valid"),document.querySelector("#auth-code-scope").classList.add("not-valid")):(document.querySelector("#auth-code-access-token").classList.remove("not-valid"),document.querySelector("#auth-code-refresh-token").classList.remove("not-valid"),document.querySelector("#auth-code-expires-in").classList.remove("not-valid"),document.querySelector("#auth-code-scope").classList.remove("not-valid"))},c=setInterval(e,1e3);e()}else console.log("No tokens found in localStorage")}_();document.querySelector("#auth-code-refresh-access-token").addEventListener("click",async function(){if(localStorage.getItem("auth_code_refresh_token")){let r="https://api.dailymotion.com/oauth/token";try{const t=await fetch(r,{method:"POST",mode:"cors",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",client_id:l,client_secret:d,refresh_token:localStorage.getItem("auth_code_refresh_token")})});if(!t.ok)throw new Error(`Response status: ${t.status}`);const o=await t.json();if(console.log(o),o.access_token&&o.refresh_token&&o.expires_in){localStorage.setItem("auth_code_access_token",o.access_token),localStorage.setItem("auth_code_refresh_token",o.refresh_token),localStorage.setItem("auth_code_scope",o.scope);const e=Date.now()+o.expires_in*1e3;localStorage.setItem("auth_code_expires_at",e),console.log("Tokens saved to localStorage");const c=a.replace("auth-code-url.html","");window.location.href=c}else console.error("Tokens not found in response")}catch(t){console.error(t)}}});
